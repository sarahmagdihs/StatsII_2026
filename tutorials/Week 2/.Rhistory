library(readxl)
cbg_turnover_v23upload <- read_excel("~/Downloads/cbg_turnover_v23upload.xlsx")
View(cbg_turnover_v23upload)
data <- read_excel("~/Downloads/cbg_turnover_v23upload.xlsx")
getwd()
library(readxl)
library(ggplot2)
library(tidyverse)
## loading the data
data <- read_excel("cbg_turnover_v23upload.xlsx")
data_raw <- read_excel("cbg_turnover_v23upload.xlsx")
str(data_raw)
naems(data_raw)
str(data_raw)
names(data_raw)
View(data_raw)
library(readxl)
cbg_turnover_v23upload <- read_excel("cbg_turnover_v23upload.xlsx",
sheet = "data v2023")
View(cbg_turnover_v23upload)
data_raw <- read_excel("cbg_turnover_v23upload.xlsx",
+ sheet = "data v2023")
data_raw <- read_excel("cbg_turnover_v23upload.xlsx",
+     sheet = "data v2023")
View(cbg_turnover_v23upload)
data_raw <- read_excel("cbg_turnover_v23upload.xlsx")
View(data_raw)
data <- data_raw %>%
select(
codewdi,
country,
year,
`time to regular turnover`,
`regular turnover dummy`,
`irregular turnover dummy`,
`legal duration`
) %>%
mutate(
codewdi = as.factor(codewdi),
country = as.factor(country),
year = as.integer(year),
time_to_regular_turnover = as.integer(`time to regular turnover`),
regular_turnover = as.integer(`regular turnover dummy`),
irregular_turnover = as.integer(`irregular turnover dummy`),
legal_duration = as.integer(`legal duration`)
) %>%
drop_na()
data <- data %>%
select(
codewdi,
country,
year,
time_to_regular_turnover,
regular_turnover,
irregular_turnover,
legal_duration
)
str(data)
unique(data$year)
unique(data$time_to_regular_turnover)
unique(data$regular_turnover)
unique(data$irregular_turnover)
unique(data$legal_duration)
bad_codes <- c(-999, -666, -555, -881)
data <- data %>%
mutate(
across(
c(year, time_to_regular_turnover, regular_turnover, irregular_turnover, legal_duration
),
~ replace(., . %in% bad_codes, NA)
)
)
lapply(
data[c("year",
"time_to_regular_turnover",
"regular_turnover",
"irregular_turnover",
"legal_duration")],
unique
)
data <- data %>% drop_na()
data
str(data_raw)
names(data_raw)
lapply(
data[c("year",
"time_to_regular_turnover",
"regular_turnover",
"irregular_turnover",
"legal_duration")],
unique
)
unique(data$regular_turnover)
unique(data$irregular_turnover)
View(data)
country_turnover <- data %>%
group_by(country) %>%
summarize(
avg_turnover = mean(irregular_turnover),
n = n()
)
View(country_turnover)
country_turnover %>%
arrange(desc(avg_turnover)) %>%
slice(1:5)
country_turnover %>%
arrange(avg_turnover) %>%
slice(1:5)
ggplot(country_turnover, aes(x = avg_turnover)) +
geom_histogram(bins = 30, fill = "steelblue", alpha = 0.7) +
labs(
x = "Average Irregular Turnover Rate",
y = "Number of Countries",
title = "Distribution of Country-Level Irregular Turnover Rates"
)
lpm <- lm(
irregular_turnover ~ time_to_regular_turnover + legal_duration,
data = data
)
summary(lpm)
typical <- data.frame(
time_to_regular_turnover = median(data$time_to_regular_turnover, na.rm = TRUE),
legal_duration = median(data$legal_duration, na.rm = TRUE)
)
predict(lpm, newdata = typical)
data$lpm_pred <- predict(lpm)
data %>%
filter(lpm_pred < 0 | lpm_pred > 1) %>%
select(country, year, lpm_pred) %>%
head()
grid <- data.frame(
time_to_regular_turnover = seq(
min(data$time_to_regular_turnover, na.rm = TRUE),
max(data$time_to_regular_turnover, na.rm = TRUE),
length.out = 100
),
legal_duration = median(data$legal_duration, na.rm = TRUE)
)
grid$lpm_fit <- predict(lpm, newdata = grid)
library(ggplot2)
ggplot(grid, aes(x = time_to_regular_turnover, y = lpm_fit)) +
geom_line(color = "blue", linewidth = 1) +
labs(
x = "Time to Regular Turnover",
y = "Predicted Probability of Irregular Turnover",
title = "LPM Predicted Probability"
)
logit <- glm(
irregular_turnover ~ time_to_regular_turnover + legal_duration,
data = data,
family = binomial
)
summary(logit)
predict(logit, newdata = typical, type = "response")
grid <- data.frame(
time_to_regular_turnover = seq(
min(data$time_to_regular_turnover, na.rm = TRUE),
max(data$time_to_regular_turnover, na.rm = TRUE),
length.out = 100
),
legal_duration = median(data$legal_duration, na.rm = TRUE)
)
grid$lpm_fit <- predict(lpm, newdata = grid)
# (b) Use the logit model to compute fitted probabilities for the same legal duration values
grid$logit_fit <- predict(logit, newdata = grid, type = "response")
# (c) Plot both curves on the same graph (e.g. blue for lm(), red for glm())
ggplot(grid, aes(x = time_to_regular_turnover)) +
geom_line(aes(y = lpm_fit, color = "LPM"), linewidth = 1) +
geom_line(aes(y = logit_fit, color = "Logit"), linewidth = 1) +
scale_color_manual(values = c("LPM" = "blue", "Logit" = "red")) +
labs(
x = "Time to Regular Turnover",
y = "Predicted Probability of Irregular Turnover",
color = "Model",
title = "LPM vs Logit Predictions"
)
# Interpretation of the plot:
# LPM (blue): Linear
# Can exceed 0 and 1; Overstates probability in “typical” cases
# Logit (red): S-shaped
# Bounded; Shows irregular turnover is rare except in extreme situations
# This is the core justification for using logit.
logit_fe <- glm(
irregular_turnover ~ time_to_regular_turnover + legal_duration + factor(country),
data = data,
family = binomial
)
summary(logit_fe)
# (b) Compare the estima
